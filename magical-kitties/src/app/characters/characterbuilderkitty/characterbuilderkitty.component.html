<div class="flex items-center sm:items-baseline ml-3 mr-3 sm:ml-0 sm:mr-0">
    <div class="flex flex-col w-1/3">
        <span class="sm:text-xl font-semibold">Character Level: {{ character?.level }}</span>
    </div>
    <div class="ml-5 w-1/3 sm:ml-auto flex flex-col items-center sm:flex-row sm:justify-end sm:items-baseline">
        <span class="mr-2 font-semibold">XP</span>
        <mat-form-field
            class="max-w-24"
            appearance="outline"
            subscriptSizing="dynamic"
        >
            <input
                matInput
                type="number"
                min="0"
                [formControl]="xpControl"
                (blur)="updateXP(getValue($event))"
            />
        </mat-form-field>
    </div>
    <div class="ml-8 w-1/3 sm:w-auto flex flex-col items-center sm:flex-row sm:justify-end sm:items-baseline">
        <span class="mr-2 font-semibold">Level</span>
        <mat-form-field
            class="max-w-24"
            appearance="outline"
            subscriptSizing="dynamic"
        >
            <mat-select
                [formControl]="levelControl"
                (selectionChange)="updateLevel($event)"
            >
                <mat-option
                    *ngFor="let item of levelOptions"
                    [value]="item"
                >
                    {{ item }}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</div>
<div class="mt-2 mb-2 sm:mt-5 sm:mb-5">
    <mat-divider class="editor"></mat-divider>
</div>
<div class="flex justify-around mt-4">
    <div class="flex flex-col">
        <span class="ml-auto mr-auto text-xl font-semibold">Cunning</span>
        <mat-form-field
            class="mt-1 max-w-28"
            appearance="outline"
        >
            <mat-select
                [formControl]="cunningControl"
                (selectionChange)="updateAttribute($event, AttributeOption.cunning)"
            >
                <mat-option [value]="0">-</mat-option>
                <mat-option
                    *ngFor="let item of statArray"
                    [value]="item"
                    [class.hide]="isFiltered(item)"
                    >{{ item }}</mat-option
                >
            </mat-select>
        </mat-form-field>
    </div>
    <div class="flex flex-col">
        <span class="ml-auto mr-auto text-xl font-semibold">Cute</span>
        <mat-form-field
            class="mt-1 max-w-28"
            appearance="outline"
        >
            <mat-select
                [formControl]="cuteControl"
                (selectionChange)="updateAttribute($event, AttributeOption.cute)"
            >
                <mat-option [value]="0">-</mat-option>
                <mat-option
                    *ngFor="let item of statArray"
                    [class.hide]="isFiltered(item)"
                    [value]="item"
                    >{{ item }}</mat-option
                >
            </mat-select>
        </mat-form-field>
    </div>
    <div class="flex flex-col">
        <span class="ml-auto mr-auto text-xl font-semibold">Fierce</span>
        <mat-form-field
            class="mt-1 max-w-28"
            appearance="outline"
        >
            <mat-select
                [formControl]="fierceControl"
                (selectionChange)="updateAttribute($event, AttributeOption.fierce)"
            >
                <mat-option [value]="0">-</mat-option>
                <mat-option
                    *ngFor="let item of statArray"
                    [value]="item"
                    [class.hide]="isFiltered(item)"
                    >{{ item }}</mat-option
                >
            </mat-select>
        </mat-form-field>
    </div>
</div>
<div class="flex items-baseline mt-4">
    <mat-card
        class="min-w-full"
        appearance="outlined"
    >
        <mat-card-header>
            <span class="text-xl font-semibold mb-2">Flaw</span>
            <mat-icon
                class="ml-auto cursor-pointer"
                (click)="openInfoDialog(characterApi.rules?.flaws, flawControl.value)"
                >help</mat-icon
            >
        </mat-card-header>
        <mat-card-content>
            <div class="flex">
                <mat-form-field
                    appearance="outline"
                    class="w-1/3"
                >
                    <mat-select
                        [formControl]="flawControl"
                        (selectionChange)="updateFlaw($event)"
                    >
                        <mat-option
                            *ngFor="let flaw of characterApi.rules?.flaws"
                            [value]="flaw.id"
                        >
                            {{ flaw.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <markdown
                    class="max-w-1/2 wrap-normal ml-auto"
                    [data]="getFlawDescription(flawControl.value)"
                >
                </markdown>
            </div>
        </mat-card-content>
    </mat-card>
</div>
<div class="flex items-baseline mt-4">
    <mat-card
        class="min-w-full"
        appearance="outlined"
    >
        <mat-card-header>
            <span class="text-xl font-semibold mb-2">Talent</span>
            <mat-icon
                class="ml-auto cursor-pointer"
                (click)="openInfoDialog(characterApi.rules?.talents, talentControl.value)"
                >help</mat-icon
            >
        </mat-card-header>
        <mat-card-content>
            <div class="flex">
                <mat-form-field
                    appearance="outline"
                    class="w-1/3"
                >
                    <mat-select
                        [formControl]="talentControl"
                        (selectionChange)="updateTalent($event)"
                    >
                        <mat-option
                            *ngFor="let talent of characterApi.rules?.talents"
                            [value]="talent.id"
                        >
                            {{ talent.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <markdown
                    class="max-w-1/2 wrap-normal ml-auto"
                    [data]="getTalentDescription(talentControl.value)"
                >
                </markdown>
            </div>
        </mat-card-content>
    </mat-card>
</div>
<div class="flex items-baseline mt-4 mb-4">
    <mat-card
        class="min-w-full"
        appearance="outlined"
    >
        <mat-card-header>
            <span class="text-xl font-semibold mb-2">Magical Power</span>
            <mat-icon
                class="ml-auto cursor-pointer"
                (click)="openInfoDialog(characterApi.rules?.magicalPowers, magicalPowerControl.value)"
                >help</mat-icon
            >
        </mat-card-header>
        <mat-card-content class="h-40">
            <div class="flex">
                <div class="w-1/3">
                    <mat-form-field appearance="outline">
                        <mat-select
                            [formControl]="magicalPowerControl"
                            (selectionChange)="updateMagicalPower($event)"
                        >
                            <mat-option
                                *ngFor="let magicalPower of characterApi.rules?.magicalPowers"
                                [value]="magicalPower.id"
                            >
                                {{ magicalPower.name }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <div class="w-1/2 ml-auto max-h-36 overflow-auto">
                    <markdown [data]="getMagicalPowerDescription(magicalPowerControl.value)"> </markdown>
                </div>
            </div>
        </mat-card-content>
    </mat-card>
</div>
<div
    class="mb-5"
    *ngIf="character ? character.level > 1 : false"
>
    <div
        class="flex flex-col upgrade-spacing"
        [formGroup]="selectedUpgrades"
    >
        <mat-label class="font-semibold">Levels 2-4</mat-label>
        <div class="flex items-baseline">
            <app-bonus-feature
                [id]="getUpgradeIdFromRules(1, UpgradeOption.bonusFeature)"
                [disabled]="block1Bonus.disabled"
                [parentControl]="block1Bonus"
                (upgradeSelected)="checkChange()"
            ></app-bonus-feature>
        </div>
        <div class="flex items-baseline">
            <app-attribute-increase
                [id]="getUpgradeIdFromRules(1, UpgradeOption.attribute3)"
                [disabled]="block1Attribute.disabled"
                [parentControl]="block1Attribute"
                (upgradeSelected)="checkChange()"
            >
            </app-attribute-increase>
        </div>
        <div>
            <app-increase-limit
                [id]="getUpgradeIdFromRules(1, UpgradeOption.owieLimit)"
                [disabled]="block1owieLimit.disabled"
                [parentControl]="block1owieLimit"
                (upgradeSelected)="checkChange()"
            ></app-increase-limit>
        </div>
        <div>
            <app-increase-limit
                [id]="getUpgradeIdFromRules(1, UpgradeOption.treatsValue)"
                [disabled]="block1treatsValue.disabled"
                [parentControl]="block1treatsValue"
                (upgradeSelected)="checkChange()"
            ></app-increase-limit>
        </div>
    </div>
</div>
<div
    class="mb-5"
    *ngIf="character ? character.level > 4 : false"
>
    <div
        class="flex flex-col upgrade-spacing"
        [formGroup]="selectedUpgrades"
    >
        <mat-label class="font-semibold">Levels 5-7</mat-label>
        <div class="flex items-baseline">
            <app-talent
                [id]="getUpgradeIdFromRules(2, UpgradeOption.talent)"
                [disabled]="block2talent.disabled"
                [parentControl]="block2talent"
                (upgradeSelected)="checkChange()"
            ></app-talent>
        </div>
        <div class="flex items-baseline">
            <app-bonus-feature
                [id]="getUpgradeIdFromRules(2, UpgradeOption.bonusFeature)"
                [disabled]="block2Bonus.disabled"
                [parentControl]="block2Bonus"
                (upgradeSelected)="checkChange()"
            ></app-bonus-feature>
        </div>
        <div class="flex items-baseline">
            <app-attribute-increase
                [id]="getUpgradeIdFromRules(2, UpgradeOption.attribute4)"
                [disabled]="block2Attribute.disabled"
                [parentControl]="block2Attribute"
                (upgradeSelected)="checkChange()"
            >
            </app-attribute-increase>
        </div>
        <div>
            <app-increase-limit
                [id]="getUpgradeIdFromRules(2, UpgradeOption.owieLimit)"
                [disabled]="block2owieLimit.disabled"
                [parentControl]="block2owieLimit"
                (upgradeSelected)="checkChange()"
            ></app-increase-limit>
        </div>
        <div>
            <app-increase-limit
                [id]="getUpgradeIdFromRules(2, UpgradeOption.treatsValue)"
                [disabled]="block2treatsValue.disabled"
                [parentControl]="block2treatsValue"
                (upgradeSelected)="checkChange()"
            ></app-increase-limit>
        </div>
    </div>
</div>
<div
    class="mb-5"
    *ngIf="character ? character.level > 7 : false"
>
    <div
        class="flex flex-col upgrade-spacing"
        [formGroup]="selectedUpgrades"
    >
        <mat-label class="font-semibold">Levels 8-10</mat-label>
        <div class="flex items-baseline">
            <app-magical-power
                [id]="getUpgradeIdFromRules(3, UpgradeOption.magicalPower)"
                [disabled]="block3MagicalPower.disabled"
                [parentControl]="block3MagicalPower"
                (upgradeSelected)="checkChange()"
            ></app-magical-power>
        </div>
        <div class="flex items-baseline">
            <app-bonus-feature
                [id]="getUpgradeIdFromRules(3, UpgradeOption.bonusFeature)"
                [disabled]="block3Bonus.disabled"
                [parentControl]="block3Bonus"
                (upgradeSelected)="checkChange()"
            ></app-bonus-feature>
        </div>
        <div class="flex items-baseline">
            <app-attribute-increase
                [id]="getUpgradeIdFromRules(3, UpgradeOption.attribute4)"
                [disabled]="block3Attribute.disabled"
                [parentControl]="block3Attribute"
                (upgradeSelected)="checkChange()"
            >
            </app-attribute-increase>
        </div>
        <div>
            <app-increase-limit
                [id]="getUpgradeIdFromRules(3, UpgradeOption.owieLimit)"
                [disabled]="block3owieLimit.disabled"
                [parentControl]="block3owieLimit"
                (upgradeSelected)="checkChange()"
            ></app-increase-limit>
        </div>
    </div>
</div>

<div
    class="mb-5"
    *ngIf="character ? character.level < 8 : true"
>
    <mat-accordion>
        <mat-expansion-panel
            hideToggle
            class="max-w-2/3"
        >
            <mat-expansion-panel-header>
                <mat-panel-title>
                    <span class="text-xl font-semibold">Upgrades</span>
                    <mat-icon class="ml-auto">add</mat-icon>
                </mat-panel-title>
            </mat-expansion-panel-header>
            <div class="flex flex-col">
                <div
                    class="flex flex-col"
                    *ngIf="character ? character.level < 2 : true"
                >
                    <mat-label class="font-semibold">Level 2-4</mat-label>
                    <mat-checkbox
                        [disabled]="true"
                        *ngFor="let item of getBlockRules(1)"
                        >{{ item.value }}</mat-checkbox
                    >
                </div>
                <div
                    class="flex flex-col"
                    *ngIf="character ? character.level < 5 : true"
                >
                    <mat-label class="font-semibold">Level 5-7</mat-label>
                    <mat-checkbox
                        [disabled]="true"
                        *ngFor="let item of getBlockRules(2)"
                        >{{ item.value }}</mat-checkbox
                    >
                </div>
                <div
                    class="flex flex-col"
                    *ngIf="character ? character.level < 8 : true"
                >
                    <mat-label class="font-semibold">Level 8-10</mat-label>
                    <mat-checkbox
                        [disabled]="true"
                        *ngFor="let item of getBlockRules(3)"
                        >{{ item.value }}</mat-checkbox
                    >
                </div>
            </div>
        </mat-expansion-panel>
    </mat-accordion>
</div>
